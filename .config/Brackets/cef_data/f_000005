(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","adobeid"],function(d,c){return b(d,c)})}else{if(!a.adobeIMS){a.adobeIMS=b(a.$,a.adobeid)}else{debugAlert("Please load the Javascript SDK only once.")}}}(this,function(F,N){var m={user:{allow_pop_up_window:"The browser's pop-up blocker has stopped a window from opening. To be able to sign-in, please use the browser's UI (in the address bar) to allow the window to be opened. Thank you.",confirm_expired_credentials_sign_in_again:"Your session has expired. To protect your account, you need to confirm your password periodically. Do you want to sign in again?",alert_expired_credentials_sign_in_again:"Your session has expired. To protect your account, you need to confirm your password periodically. Please sign in again.",network_error:"A network error has occurred. Are you connected to the internet?"},dev:{adobeid:"Please declare the adobeid variable before loading the Javascript file for the IMS SDK",both_modal_and_redirect:"Error: you can't have both adobeid.uses_modal_mode and adobeid.uses_redirect_mode set to true.",client_id_missing:"Error: the ClientID is missing.",api_calls_only_https:"Error: the API calls must be made only through HTTPS.",mandatory_sign_in_only_in_redirect:"is_mandatory_sign_in only works in full web redirect mode.",scope_doesnt_ask_for_userId_from_profile:"The provided scopes don't ask for the userId from the user's profile",client_id_missing_from_query:"Please add the '#client_id#' to the comma separated list that is the client_id query parameter"}};function W(e){if(window.console&&typeof(window.console.log)=="function"){window.console.log("imslib.js: "+e)}}function y(e){if(d){W(e)}}function V(e){if(d&&window.console&&typeof(window.console.error)=="function"){window.console.error("imslib.js: "+e)}}function E(e,ad,ac){if(ad>0){return e.substring(0,ad)+ac+e.substring(ad,e.length)}else{return ac+e}}function S(e,ad){var ac=-1,ae;do{ae=ac;ac=e.indexOf(ad,ac+1)}while(ac!=-1);return ae}function q(e,ac){return e.indexOf(ac)!=-1}function u(e,ac){return 0==e.indexOf(ac)}function r(e){return typeof(e)=="string"&&e.length>0}function Y(e){return e.replace(/\s/g,"")}function aa(e){if(!e){e=new Date()}if(K(e instanceof Date,"Date_asMilliseconds: provided date is not a Date.")){return 0}return Number(e)}function p(e){if(d){alert("imslib.js (message appears only on dev environments):\n"+e);W(e)}}function K(ac,e){if(!ac){p("assert: "+e);V("assert: "+e)}return !ac}function o(e){return e&&typeof(e)=="function"}function M(ad,e,ac){if(o(ad)){return ad.apply(e,ac||[])}}function D(e,ad){try{delete e[ad]}catch(ac){e[ad]=undefined}}function a(e){if(e===null){return null}if(typeof(e)!="object"){return e}if(e instanceof Array){var ad=[];Q(e,function(ae,af){ad.push(a(af))});K(z(e,ad),"cloned object has failed for "+JSON.stringify(e));return ad}var ad=new Object();for(var ac in e){ad[ac]=a(e[ac])}K(z(e,ad),"cloned object has failed for "+JSON.stringify(e));return ad}function z(ae,ad){if(ae===null){return ad===null}if(ad===null){return ae===null}if(typeof(ae)!=typeof(ad)){return false}if(ae instanceof Array){if(!(ad instanceof Array)||ae.length!=ad.length){return false}for(var e=0;e<ae.length;++e){if(!z(ae[e],ad[e])){return false}}return true}if(typeof(ae)=="object"){for(var ac in ae){if(!(ac in ad)||!z(ae[ac],ad[ac])){return false}}for(var ac in ad){if(!(ac in ae)){return false}}return true}else{return ae==ad}}function H(e){return !e||z(e,new Object())}function w(){if(document.head){return document.head}var e=document.getElementsByTagName("head");if(e&&e.length){return e[0]}return null}function h(e){return e.substring(0,S(e,"/")+1)}function b(ac){if(!ac){ac=window.location.href}var e=ac.indexOf("#");return e!=-1?ac.substring(e):""}function P(e){e=e.replace(/^(#|\?|&)/,"");var ac=new Object();Q(e.split("&"),function(ae,af){var ad=af.split("=");ac[ad[0]]=decodeURIComponent(ad[1])});return ac}function t(){if(!(window.JSON&&o(JSON.parse))){return true}if(typeof(document.querySelectorAll)!="function"){return true}if(document.body){var ac=document.createElement("div");ac.setAttribute("data-isJqueryNeeded","no");document.body.appendChild(ac);var e=document.querySelectorAll('[data-isJqueryNeeded="no"]');document.body.removeChild(ac);return e.length!=1}return false}function L(e){if(G){return G(e)}if(document.querySelectorAll){return document.querySelectorAll(e)}return[]}function Q(ad,e){if(G&&G.each){G.each.call(G,ad,e)}else{for(var ac=0;ac<ad.length;++ac){if(false===e.call(ad[ac],ac,ad[ac])){break}}}}function s(ac,ad){for(var e=0;e<ad.length;++e){if(z(ad[e],ac)){return true}}return false}function ab(ad,ac,e){if(G){G(ad).on(ac,e)}else{if(ad.addEventListener){ad.addEventListener(ac,e,false)}else{if(ad.attachEvent){ad.attachEvent("on"+ac,e)}}}}function x(e){if(G){return G.parseJSON(e)}return JSON.parse(e)}function k(af,ag){var e=a(af);for(var ac=1;ac<arguments.length;++ac){var ag=arguments[ac];if(typeof(ag)!="object"){continue}for(var ad in ag){var ae=ag[ad];if(typeof(ae)!="undefined"){if(typeof(ae)!="object"){e[ad]=ae}else{e[ad]=k(e[ad]||new Object(),ae)}}else{D(e,ad)}}}return e}var i=document.querySelector&&document.querySelector('script[src*="imslib.js"]');var d=i&&i.src.match(/^http(s:\/\/ims-na1-(dev|qa)\d\.adobelogin\.com)|(s?:\/\/[\w-]+\.(corp|eur)\.adobe\.com)|(s:\/\/adobeid-na1-(dev|qa)\d\.services\.adobe\.com)/i);if(d){if(i){W("loaded from "+i.src)}W("isDebugMode")}function A(ad){if(ad===null||typeof ad==="undefined"){return true}try{ad.setItem("isStoragePolyfillNeeded",true);if(ad.getItem("isStoragePolyfillNeeded")!="true"){return true}ad.removeItem("isStoragePolyfillNeeded");return false}catch(ac){return true}}var c=null;try{c=window.localStorage}catch(X){if(d){W("localStorage disabled")}}if(A(c)){if(d){W("isStoragePolyfillNeeded")}var U=function(){var e={};return{length:0,clear:function(){e={};this.length=0},getItem:function(ac){var ad=e[ac];return typeof(ad)=="undefined"?null:ad},keys:function(){return e},removeItem:function(ac){if(!e.hasOwnProperty(ac)){return}D(e,ac);--this.length},setItem:function(ac,ad){if(!e.hasOwnProperty(ac)){++this.length}e[ac]=String(ad)}}};c=new U();K(!A(c),"isLocalStoragePolyfillNeeded")}var B,C="adobeid_ims_access_token",g="/",f="adobeid_ims_profile",R="adobeid_cookie_expires_at",Z={remember_me:14*24*3600*1000,not_remember_me:15*60*1000},l="from_ims",v=l+"=true",T="rctx",J="redirectims.html",I="ims_modal_window",j={sign_in:{width:600,height:700},sign_up:{width:600,height:850},sign_out:{width:320,height:240},jump:{width:600,height:850},any:{width:800,height:600}},G=null;function O(){if(!(window.JSON&&o(window.JSON.stringify))){var ac=document.createElement("script");w().appendChild(ac);ac.type="text/javascript";ac.src="https://cdnjs.cloudflare.com/ajax/libs/json2/20130526/json2.min.js"}var e=this;if(typeof(N)=="object"){this.adobeid=N}else{if(this._isFinalRedirectPageInModalMode()){this.adobeid=window.opener.adobeid||new Object()}else{this.adobeid=(window.adobeid=new Object());p(m.dev.adobeid)}}if(this.adobeid.strings&&this.adobeid.strings.user){m.user=this.adobeid.strings.user}if(!d&&this.adobeid.uses_debug_mode){d=true}this._accessTokensInfos=new Object();this._profile=null;this._is_already_attached_to_ui=false;this._last_ui_update={_any_update_so_far:false,_accessTokensInfos:new Object(),_profile:null,update:function(){this._any_update_so_far=true;this._accessTokensInfos=a(e._accessTokensInfos);this._profile=a(e._profile)},areThereUIUpdatesToPerformForAccessTokens:function(){if(!this._any_update_so_far){return true}return !z(this._accessTokensInfos,e._accessTokensInfos)},areThereUIUpdatesToPerformForProfile:function(){if(!this._any_update_so_far){return true}return !z(this._profile,e._profile)},areThereUIUpdatesToPerform:function(){return this.areThereUIUpdatesToPerformForProfile()||this.areThereUIUpdatesToPerformForAccessTokens()}}}O.prototype={IMSAPIs:{},errors:{network:{name:"networkError",userMessage:m.user.network_error},fromApiCallRedirect:{name:"fromApiCallRedirectError",userMessage:"",setMessage:function(e){this.userMessage=e;return this}},avatarPicture:{name:"avatarPictureError",userMessage:m.dev.scope_doesnt_ask_for_userId_from_profile},jsException:{name:"jsExceptionError",message:"",exception:null,setException:function(ad,ac){this.exception=ad;this.message=ac||"";return this}}},getUrlForApiCall:function(af,ac,ah){if(arguments.length==2){ah=arguments[1];ac=null}var ai=ah.client_id?ah.client_id:this.getClientID(af);var ad=af.endpoint[ai];if(typeof(ad)!="string"){p(m.dev.client_id_missing_from_query.replace("#client_id#",ai));return""}if(ac){ad+="/"+ac}var e=true;for(var ae in ah){var ag=ah[ae];if(ag===undefined){continue}ad+=(e?"?":"&")+ae+"="+encodeURIComponent(typeof(ag)=="object"?JSON.stringify(ag):ag);e=false}K(ad.length<2083,"this url is too long for visitors using IE<=8:\n"+ad);return ad},makeApiCall:function(ad,ac,ae,e){if(arguments.length==3){e=arguments[2];ae=arguments[1];ac=null}if(d){W("#api# api call with #params# parameters".replace("#api#",ad.name).replace("#params#",JSON.stringify(ae)))}this._ajaxGet(this.getUrlForApiCall(ad,ac,ae),e,"jsonp")},getUserProfile:function(){return this._profile},getUserPictureURL:function(){if(!this._profile){return""}if(this._profile.userId){return this.getUrlForApiCall(this.IMSAPIs.avatar,{})+"/"+this._profile.userId}else{this._onError(this.errors.avatarPicture);return""}},getAccessTokenInfo:function(ac,ad,e){return this._accessTokensInfos[this.getAccessTokenSessionStorageKey(ac,ad,e)]},getAccessToken:function(ac,ae,e){var ad=this.getAccessTokenInfo(ac,ae,e);return ad?ad.access_token:null},getAccessTokenSessionStorageKey:function(ac,ad,e){return[C,ad||this.getClientID(),Boolean(ac),e||this.getScope()].join(g)},getKeyForAccessToken:function(ac){for(var e in this._accessTokensInfos){if(ac==this._accessTokensInfos[e].access_token){return e}}K(false,"unknown access_token for key: "+e);return null},_isAccessTokenInfoUsable:function(e){return e&&typeof(e.access_token)=="string"&&typeof(e.client_id)=="string"&&this.isKnownClientID(e.client_id)&&typeof(e.scope)=="string"&&typeof(e.expires_in)=="number"&&typeof(e.expiresAtMilliseconds)=="number"&&typeof(e.isReAuthentication)=="boolean"},loadFromStorage:function(){this._accessTokensInfos=new Object();for(var ac in c.keys?c.keys():c){if(u(ac,C)){try{var ad=x(c.getItem(ac));if(!this.isKnownClientID(ad.client_id)){continue}if(this._isAccessTokenInfoUsable(ad)){this._accessTokensInfos[ac]=ad}else{p("unusable access token info: "+c.getItem(ac));c.removeItem(ac)}}catch(ae){c.removeItem(ac)}}}this._profile=x(c.getItem(f))},hasTokenButItHasExpired:function(ac,ae,e){var ad=this.getAccessTokenInfo(ac,ae,e);return ad&&aa()>ad.expiresAtMilliseconds?ad:undefined},isSignedInUser:function(ac,ae,e){var ad=this.getAccessTokenInfo(ac,ae,e);return ad&&aa()<ad.expiresAtMilliseconds?ad:undefined},signIn:function(ad,ac){this.contextToBePassedOnRedirect=ac;var e=k({response_type:"token",client_id:this.getClientID(this.IMSAPIs.authorize,ad),scope:this.getScope(),locale:this.getLocale()},this.getAdobeIdApiParametersForApi(this.IMSAPIs.authorize),ad);e.redirect_uri=this._getRedirectUri(this.IMSAPIs.authorize,e);if(this.isModal()){this._callCallbacksToUpdateUI()}this._openWindow(this.getUrlForApiCall(this.IMSAPIs.authorize,e),e.idp_flow=="create_account"?j.sign_up:j.sign_in)},reAuthenticate:function(ad,ac){var e=k({reauth:"check",puser:this._profile&&this._profile.email?this._profile.email:undefined,eu:this._profile&&this._profile.email?"true":undefined},this.getAdobeIdApiParametersForApi(this.IMSAPIs.authorize),ad);this.signIn(e,ac)},isReAuthentication:function(e){return e&&e.reauth},updateRedirectUriForReAuthentication:function(e,ac){if(!(typeof(e)=="string"&&this.isReAuthentication(ac))){return e}if(!q(e,"reauth=")){e=e+"&reauth="+ac.reauth}return e},getContextFromRedirectForAccessToken:function(ac){if(this.contextPassedFromRedirect&&this.contextPassedFromRedirect.access_token==ac){var e=this.contextPassedFromRedirect.context;this.contextPassedFromRedirect=null;return e}else{return null}},signUp:function(ac,e){if(this.isModal()){this._callCallbacksToUpdateUI()}this.signIn(k({idp_flow:"create_account"},ac),e)},signOut:function(af){var ac=k(this.getAdobeIdApiParametersForApi(this.IMSAPIs.logout),af);var ae=this.getAccessTokenInfo(false,ac.client_id,ac.scope);if(!ae){this._clearCredentials({updateUI:true});return}if(this.isModal()&&ac.redirect_uri){this.switchToRedirectMode()}var ad=k({access_token:ae.access_token,redirect_uri:this._getRedirectUri(this.IMSAPIs.logout,ac)},ac);var e=this.getUrlForApiCall(this.IMSAPIs.logout,ad);this._clearCredentials({updateUI:true});this._openWindow(e,j.sign_out)},switchToRedirectMode:function(){this.adobeid.uses_modal_mode=false;this.adobeid.uses_redirect_mode=true},switchToModalMode:function(){this.adobeid.uses_modal_mode=true;this.adobeid.uses_redirect_mode=false},_clearCredentials:function(ac){if(ac&&ac.access_token){var e=this.getKeyForAccessToken(ac.access_token);c.removeItem(e);D(this._accessTokensInfos,e)}else{for(var e in this._accessTokensInfos){if(u(e,C)){c.removeItem(e)}}this._accessTokensInfos=new Object();c.removeItem(f);this._profile=null;c.removeItem(R);this._clearTimerTestSSOCookieWillExpire()}if(ac&&ac.updateUI===true){this._callCallbacksToUpdateUI(ac)}},_callCallbacksToUpdateUI:function(af){if(!this._last_ui_update.areThereUIUpdatesToPerform()){return}var ad=a(this._last_ui_update);this._last_ui_update.update();if(o(this.adobeid.onProfile)&&ad.areThereUIUpdatesToPerformForProfile()){try{M(this.adobeid.onProfile,this.adobeid,[this._profile])}catch(ae){this._onError(this.errors.jsException.setException(ae,"adobeid.onProfile"))}}if(o(this.adobeid.onAccessToken)&&ad.areThereUIUpdatesToPerformForAccessTokens()){try{for(var ac in this._accessTokensInfos){if(!z(this._accessTokensInfos[ac],ad._accessTokensInfos[ac])){if(!af||(af&&af.access_token&&af.access_token==this._accessTokensInfos[ac].access_token)){M(this.adobeid.onAccessToken,this.adobeid,[this._accessTokensInfos[ac].access_token,this._accessTokensInfos[ac]])}}}}catch(ae){this._onError(this.errors.jsException.setException(ae,"adobeid.onAccessToken"))}}},_onReady:function(){if(this.onReadyAlreadyCalled){return}this.onReadyAlreadyCalled=true;this._callCallbacksToUpdateUI();try{M(this.adobeid.onReady,this.adobeid)}catch(ac){this._onError(this.errors.jsException.setException(ac,"adobeid.onReady"))}},_onError:function(ac){try{M(this.adobeid.onError,this.adobeid,[ac])}catch(ad){}if(typeof(this.adobeid.onError)!=="function"){if(typeof(ac.userMessage)=="string"){y(ac.userMessage)}else{V("unhandled javascript error: "+JSON.stringify(ac))}}},_update_url_ims_api:function(){this.IMSAPIs={authorize:{name:"authorize",endpoint:{bracketsextract1:"https://ims-na1.adobelogin.com/ims/authorize/v1"}},check:{name:"check/token",endpoint:{bracketsextract1:"https://adobeid-na1.services.adobe.com/ims/check/v1/token"}},check_status:{name:"check/status",endpoint:{bracketsextract1:"https://adobeid-na1.services.adobe.com/ims/check/v1/status"}},logout:{name:"logout",endpoint:{bracketsextract1:"https://adobeid-na1.services.adobe.com/ims/logout/v1"}},profile:{name:"profile",endpoint:{bracketsextract1:"https://ims-na1.adobelogin.com/ims/profile/v1"}},validate_token:{name:"validate_token",endpoint:{bracketsextract1:"https://ims-na1.adobelogin.com/ims/validate_token/v1"}},avatar:{name:"avatar/download",endpoint:{bracketsextract1:"https://ims-na1.adobelogin.com/ims/avatar/download"}},versions:{v1:"v1"}};if(this.adobeid.target_env){var af={replaceWhat:/https?:\/\/adobeid-na1-(dev|qa|stg)\d\.services\.adobe\.com/i,replaceWith:"https://adobeid-na1-"+this.adobeid.target_env+".services.adobe.com"},ad={replaceWhat:/https?:\/\/ims-na1-(dev|qa|stg)\d\.adobelogin\.com/i,replaceWith:"https://ims-na1-"+this.adobeid.target_env+".adobelogin.com"},e=/https?:\/\/\S*\.corp\.adobe\.com(:\d*)?/i;for(var ah in this.IMSAPIs){var ac=this.IMSAPIs[ah];if(H(ac.endpoint)){continue}for(var ai in ac.endpoint){var ae=e.test(ac.endpoint[ai]);if(ae){var ag=q(ac.name,"check")||q(ac.name,"logout")?af:ad;ac.endpoint[ai]=ac.endpoint[ai].replace(e,ag.replaceWith)}else{ac.endpoint[ai]=ac.endpoint[ai].replace(af.replaceWhat,af.replaceWith).replace(ad.replaceWhat,ad.replaceWith)}}}if(d){W("target_env = "+this.adobeid.target_env);W("authorize = "+this.IMSAPIs.authorize.endpoint[this.getClientID(this.IMSAPIs.authorize)]);W("check = "+this.IMSAPIs.check.endpoint[this.getClientID(this.IMSAPIs.check)])}}},_initialize:function(){var e=this;this._update_url_ims_api();this._signInWhenRedirectedBackFromIMS(function(){if(e._isFinalRedirectPageInModalMode()){if(window.opener){window.opener.adobeIMS._importDataFromModalWindow(e);window.close()}}else{e._attachHandlersToUI();e._signInBasedOnStoredCredentials(function(){if(e.isSignedInUser()){e._testAccessTokensAreStillValid()}else{if(!e.hasJustSingleLoggedOutSLO){e.signInBasedOnSingleSignOnSSO(function(){if(e.isMandatorySignIn()&&!e.isSignedInUser()){e.signIn()}e._onReady()})}else{e.hasJustSingleLoggedOutSLO=false;e._callCallbacksToUpdateUI();if(e.isMandatorySignIn()&&!e.isSignedInUser()){e.signIn()}e._onReady()}}})}})},_signInWhenRedirectedBackFromIMS:function(af,e){var ap=this;var ag=b(e).substring(1);ag=ag.replace("%23expires_in","#expires_in").replace("%23error","#error").replace("?error","#error").replace("#","&");var am=P(ag);var ak=am.access_token;var ae=am.api;if(ae==this.IMSAPIs.authorize.name){K(ak,"the authorize api must return an access_token")}var aj=Boolean(am.reauth);var ai=am.client_id||this.getClientID();var ao=am.scope||this.getScope();var an=am.expires_in;var ah=am[l]==="true";var al=am.error;var ad=am[T];this.contextPassedFromRedirect=ad?{context:x(ad),access_token:ak}:null;var ac=(ak&&an)||(ah&&ae==this.IMSAPIs.logout.name)||(al&&ah);if(!ac){af.call(this);return}window.location.hash=am.old_hash||"";if(ak){this.hasJustReturnedFromAuthorize=true;this._setAccessTokenAndGetProfile(ak,aj,ai,ao,an,null,function(){ap.validateSSOCookieLifetime(ak,af)})}else{this._accessTokensInfos=new Object();this._profile=null;if(al){this._onError(this.errors.fromApiCallRedirect.setMessage(al))}af.call(this)}},_setAccessTokenAndGetProfile:function(af,ae,ad,ak,ag,aj,ac){var al=this;ag=Number(ag);var ai=aj&&aj.userId;this._removeAccessTokensIfDifferentUserId(ai);if(H(this._accessTokensInfos)){this.loadFromStorage()}if(!this.shouldAcceptTheToken(af,ad,ak,ai,true,ae)){M(ac,al);return}var ah=this.getAccessTokenSessionStorageKey(ae,ad,ak);var e=aa();this._accessTokensInfos[ah]={access_token:af,client_id:ad,user_id:ai,scope:ak,expires_in:ag,createdAtMilliseconds:e,expiresAtMilliseconds:e+ag,isReAuthentication:ae};c.setItem(ah,JSON.stringify(this._accessTokensInfos[ah]));if(this.onReadyAlreadyCalled){this._callCallbacksToUpdateUI()}if(aj){M(ac,al)}else{this.makeApiCall(this.IMSAPIs.profile,k({bearer_token:af},this.getAdobeIdApiParametersForApi(this.IMSAPIs.profile)),function(am){al.setProfile(am);M(ac,al)})}},setProfile:function(e){if(!e||e.error_flag){return}this._profile=e;if(e){c.setItem(f,JSON.stringify(this._profile))}else{c.removeItem(f)}if(this.onReadyAlreadyCalled){this._callCallbacksToUpdateUI()}},_removeAccessTokensIfDifferentUserId:function(e){if(!e){return}for(var ac in this._accessTokensInfos){var ad=this._accessTokensInfos[ac];if(ad.user_id&&ad.user_id!=e){this._clearCredentials({access_token:ad.access_token,updateUI:false});if(d){W("remove token because of different user_id (isReAuthentication="+ad.isReAuthentication+")")}}}},_signInBasedOnStoredCredentials:function(e){this.loadFromStorage();if(H(this._accessTokensInfos)){this._clearCredentials();M(e,this)}else{if(this.hasJustReturnedFromAuthorize){this.hasJustReturnedFromAuthorize=false;M(e)}else{this.testSingleLogOutSLO(e)}}},signInBasedOnSingleSignOnSSO:function(ad){var e=this;var ac=k({client_id:this.getClientID(this.IMSAPIs.check),scope:this.getScope(this.IMSAPIs.check),locale:this.getLocale(),redirect_uri:this._getRedirectUri(this.IMSAPIs.check)},this.getAdobeIdApiParametersForApi(this.IMSAPIs.check));this.makeApiCall(this.IMSAPIs.check,ac,function(ae){if(ae.jump){if(d){W("jump to "+ae.jump)}e._openWindow(ae.jump,j.jump)}else{if(ae.access_token){var af=a(ae);Q(["access_token","expires_in","token_type"],function(ag,ah){D(af,ah)});e.setProfile(af);e._setAccessTokenAndGetProfile(ae.access_token,false,ac.client_id,ac.scope,ae.expires_in,af,function(){e.validateSSOCookieLifetime(ae.access_token,ad)})}else{M(ad,e)}}})},testSingleLogOutSLO:function(ac){if(!this.isSingleLogOutEnabled()){M(ac,this);return}var e=this;this.makeApiCall(this.IMSAPIs.check_status,k({client_id:this.getClientID(this.IMSAPIs.check_status)},this.getAdobeIdApiParametersForApi(this.IMSAPIs.check_status)),function(ad){if(ad.sso===false&&ad.remember_me===false){e._clearCredentials({updateUI:true});e.hasJustSingleLoggedOutSLO=true;M(ac,e)}else{e.signInBasedOnSingleSignOnSSO(ac)}})},validateSSOCookieLifetime:function(ac,e){M(e,this);return},_clearTimerTestSSOCookieWillExpire:function(){if(this._timerTestSSOCookieWillExpire){clearInterval(this._timerTestSSOCookieWillExpire);this._timerTestSSOCookieWillExpire=null}},shouldAcceptTheToken:function(ai,ah,ad,ac,ag,af){var e=true;var ae=[{shouldReject:ag===false,shouldLogToErrorConsole:false,message:"access_token is invalid."},{shouldReject:ag===true&&ac&&this._profile&&ac!==this._profile.userId,shouldLogToErrorConsole:false,message:"access_token was from another userId (isReAuthentication=#0).".replace("#0",af)},{shouldReject:ag===true&&!this.isKnownClientID(ah),shouldLogToErrorConsole:true,message:"the #0 client_id associated with the access token is not for a known client_id (#1).".replace("#0",ah).replace("#1",Object.keys?Object.keys(this.IMSAPIs.authorize.endpoint).join(","):this.getClientID())},{shouldReject:ag===true&&!this.matchesTheRequiredScope(ad),shouldLogToErrorConsole:true,message:"the (#0) scope associated with the access token doesn't match the required scope (#1).".replace("#0",ad).replace("#1",this.getScope())},{shouldReject:!ai,shouldLogToErrorConsole:true,message:"no access token."}];Q(ae,function(aj,ak){if(ak.shouldReject){e=false;(ak.shouldLogToErrorConsole?V:y)("shouldAcceptTheToken: "+ak.message)}});return e},testAccessTokenIsStillValid:function(ag,ac){var e=this;var ae=this._accessTokensInfos[this.getKeyForAccessToken(ag)];K(ae,"we need token information to validate it");var af=function(){--e.countOfTokensToValidate;K(e.countOfTokensToValidate>=0,"countOfTokensToValidate shouldn't be negative");if(e.countOfTokensToValidate==0){M(ac,e)}};var ad=function(ah){if(ah.token&&e.shouldAcceptTheToken(ag,ah.token.client_id,ah.token.scope,ah.token.user_id,ah.valid,ae.isReAuthentication)){af()}else{y("validate/token: access_token is invalid. removing.");e._clearCredentials({updateUI:e.onReadyAlreadyCalled,access_token:ag});try{if(ah.token&&e.isKnownClientID(ah.token.client_id)&&e.matchesTheRequiredScope(ah.token.scope)){M(e.adobeid.onAccessTokenHasExpired,e.adobeid,[ag,ae])}}catch(ai){e._onError(e.errors.jsException.setException(ai,"adobeid.onAccessTokenHasExpired"))}if(ae.isReAuthentication){af()}else{e.signInBasedOnSingleSignOnSSO(function(){if(!e.isSignedInUser()){if(e.isMandatorySignIn()){e.signIn()}else{if(e.adobeid.uses_browser_dialog_when_access_token_expires){if(e.isModal()){e._displayAlertToUser(m.user.alert_expired_credentials_sign_in_again)}else{if(e._confirmAlertToUser(m.user.confirm_expired_credentials_sign_in_again)){e.signIn()}}}}}af()})}}};if(ae&&this.isKnownClientID(ae.client_id)){this.makeApiCall(this.IMSAPIs.validate_token,{token:ag,client_id:ae.client_id,"typeof":"access_token"},ad)}else{ad({valid:false})}},_testAccessTokensAreStillValid:function(){K(typeof(this.countOfTokensToValidate)=="undefined"||this.countOfTokensToValidate===0,"problem with validating tokens");this.countOfTokensToValidate=0;for(var ac in this._accessTokensInfos){++this.countOfTokensToValidate}var e=this;for(var ac in this._accessTokensInfos){e.testAccessTokenIsStillValid(this._accessTokensInfos[ac].access_token,function(){e._onReady()})}},_importDataFromModalWindow:function(ac){if(!H(ac._accessTokensInfos)){this.contextPassedFromRedirect=a(ac.contextPassedFromRedirect);if(!z(ac._profile,this._profile)&&!H(ac._profile)){this.setProfile(a(ac._profile))}for(var e in ac._accessTokensInfos){if(!z(ac._accessTokensInfos[e],this._accessTokensInfos[e])){this._accessTokensInfos[e]=a(ac._accessTokensInfos[e]);c.setItem(e,JSON.stringify(this._accessTokensInfos[e]));this.validateSSOCookieLifetime(this._accessTokensInfos[e].access_token)}}this._callCallbacksToUpdateUI();if(ac.isSignedInUser(true)&&!this.isSignedInUser(false)){this.signInBasedOnSingleSignOnSSO()}}else{this._clearCredentials({updateUI:true})}},_attachHandlersToUI:function(){if(this._is_already_attached_to_ui){return}this._is_already_attached_to_ui=true;var e=this;Q([{attribute:"signin",fnToCall:this.signIn},{attribute:"reauthenticate",fnToCall:this.reAuthenticate},{attribute:"signup",fnToCall:this.signUp},{attribute:"signout",fnToCall:this.signOut}],function(ac,ae){var ad=L('[data-adobeid-action="'+ae.attribute+'"]');Q(ad,function(af,ag){ab(ag,"click",function(){ae.fnToCall.call(e)})})})},_openWindow:function(ad,af){var ac=this,e=window;af=af||{};af.width=Math.min(af.width||j.any.width,screen.availWidth);af.height=Math.min(af.height||j.any.height,screen.availHeight);af.left=parseInt((screen.availLeft?screen.availLeft:0)+Math.max(0,screen.availWidth-af.width)/2);af.top=parseInt((screen.availTop?screen.availTop:0)+Math.max(0,screen.availHeight-af.height)/2);if(this.isModal()){if(this.adobeid.getClientWindow){var ae=function(ag){ac._signInWhenRedirectedBackFromIMS(function(){},ag)};e=this.adobeid.getClientWindow(ad,af,ae)}else{e=window.open(ad,I,"width="+width+",height="+height+",left="+left+",top="+top+",toolbar=no,menubar=no")}if(!e){this._displayAlertToUser(m.user.allow_pop_up_window);return}if(typeof(e.focus)=="function"){e.focus()}}else{if(this.isMandatorySignIn()){e.location.replace(ad)}else{e.location.href=ad}}this.contextToBePassedOnRedirect=null},isModal:function(){if(this._isFinalRedirectPageInModalMode()){return true}if(this.adobeid.uses_modal_mode===true&&this.adobeid.uses_redirect_mode===true){p(m.dev.both_modal_and_redirect);return true}return typeof(this.adobeid.uses_modal_mode)=="boolean"?this.adobeid.uses_modal_mode:(this.adobeid.uses_redirect_mode===false)},_isFinalRedirectPageInModalMode:function(){return q(window.location.href,J)&&window.opener&&window.opener!=window},getAdobeIdApiParametersForApi:function(e){if(!(e&&e.name&&this.adobeid.api_parameters)){return new Object()}for(var ac in this.adobeid.api_parameters){if(q(e.name,ac)){return this.adobeid.api_parameters[ac]}}return new Object()},getLocale:function(){return this.adobeid.locale||"en_US"},sunbreakHack:function(e){return e.replace("acct_mgmt_webui","acct_mgmt_api,gnav,update_profile.address.mail_to,update_profile.dob,update_profile.email,update_profile.first_name,update_profile.industry,update_profile.job_function,update_profile.job_title,update_profile.last_name,update_profile.mrktPerm,update_profile.password,update_profile.phoneNumber,update_profile.phonetic_name,update_profile.preferred_languages,update_profile.screen_name,update_profile.secondary_email")},matchesTheRequiredScope:function(ad){if(K(r(ad),"scopeToValidate must be a non empty string for matchesTheRequiredScope")){return false}var ac=this.sunbreakHack(Y(ad)).split(",");var e=true;Q(this.sunbreakHack(this.getScope()).split(","),function(af,ae){if(!s(ae,ac)){e=false;return false}});return e},getScope:function(ad,ae){var e=k(this.getAdobeIdApiParametersForApi(ad),ae);var ac="AdobeID,openid";if(e.scope){ac=e.scope}else{if(this.adobeid.scope){ac=this.adobeid.scope}}return Y(ac)},isKnownClientID:function(e){return e in this.IMSAPIs.authorize.endpoint},getClientID:function(ac,ad){var e=k(this.getAdobeIdApiParametersForApi(ac),ad);if(e.client_id){return e.client_id}if(this.adobeid.client_id){return this.adobeid.client_id}return"bracketsextract1"},isMandatorySignIn:function(){if(this.adobeid.is_mandatory_sign_in===true&&this.isModal()){p(m.dev.mandatory_sign_in_only_in_redirect);return false}return typeof(this.adobeid.is_mandatory_sign_in)=="boolean"?this.adobeid.is_mandatory_sign_in:false},isSingleLogOutEnabled:function(){if(typeof(this.adobeid.uses_single_log_out)=="boolean"){return this.adobeid.uses_single_log_out}return true},isRefreshSSOCookiesEnabled:function(){if(typeof(this.adobeid.uses_refresh_sso_cookies)=="boolean"){return this.adobeid.uses_refresh_sso_cookies}return false},_getRedirectUri:function(ae,ag){var ad="";var ac=k(this.getAdobeIdApiParametersForApi(ae),ag);if(this.isModal()&&!this.adobeid.override_modal_redirect){ad=h(window.location.href)+J+"#"+v}else{if(ac.redirect_uri){ad=ac.redirect_uri}else{if(this.adobeid.redirect_uri){ad=this.adobeid.redirect_uri}else{ad=window.location.href}}K(!q(ad,l),"the redirect_uri mustn't already contain #from_ims");var af=b(ad);var e=ad;if(af){e=e.substring(0,e.length-af.length)}ad=e+"#"+v+"&old_hash="+encodeURIComponent(af)}if(ac.client_id){ad+="&client_id="+encodeURIComponent(ac.client_id)}if(ac.scope){ad+="&scope="+encodeURIComponent(ac.scope)}if(ae&&ae.name){ad+="&api="+encodeURIComponent(ae.name)}ad=this.updateRedirectUriForReAuthentication(ad,ac);if(!H(this.contextToBePassedOnRedirect)){ad+="&"+T+"="+encodeURIComponent(JSON.stringify(this.contextToBePassedOnRedirect))}return ad},_ajaxGet:function(af,e,ag){var ae=this;if(/^https:\/\//i.test(af)||/^http:\/\/[\w-]+.(corp|eur).adobe.com/i.test(af)){if(this.adobeid.proxyGet){this.adobeid.proxyGet(af,e,ag).fail(function(){ae._onError(ae.errors.network)})}else{if(G){G.get.apply(G,arguments).fail(function(){ae._onError(ae.errors.network)})}else{if(ag=="jsonp"){var ah=Math.random().toString();ah="_"+ah.substring(ah.indexOf(".")+1);this[ah]=function(ai){if(d){W("api call response: "+JSON.stringify(ai))}e.call(n,ai);D(n,ah)};var ad=document.createElement("script");ad.src=af+(q(af,"?")?"&":"?")+"callback=window.adobeIMS."+ah;ab(ad,"load",function(){w().removeChild(ad)});ab(ad,"error",function(){w().removeChild(ad);ae._onError(ae.errors.network)});w().appendChild(ad)}else{var ac=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");ac.onreadystatechange=function(){if(ac.readyState==4&&ac.status==200){e.call(null,ac.responseText)}};ac.onerror=function(){ae._onError(ae.errors.network)};ac.open("GET",af,true);ac.send()}}}}else{p(m.dev.api_calls_only_https)}},_displayAlertToUser:function(e){alert(e)},_confirmAlertToUser:function(e){return confirm(e)},_handleTheJQueryDependency:function(){var ad=this;if(t()){var e=function(){G=window.jQuery;G(document).ready(function(){ad._initialize()})};if(typeof(window.jQuery)=="undefined"){var ac=document.createElement("script");w().appendChild(ac);ac.type="text/javascript";ac.src="https://code.jquery.com/jquery-1.11.0.min.js";var ae=function(){if(window.jQuery){e.call()}else{setTimeout(ae,50)}};ae()}else{e.call()}}else{G=F;this._initialize()}},_waitForDOMContentLoaded:function(){var ac=this;var ad=false;var e=function(){if(ad){return}ad=true;ac._handleTheJQueryDependency()};if(document.readyState=="complete"||document.readyState=="loaded"){e.call()}else{ab(document,"DOMContentLoaded",e);ab(window,"load",e)}}};var n=new O();n._waitForDOMContentLoaded();return n}));